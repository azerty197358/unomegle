<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Join SparkChat for free random video chat with strangers.">
  <title>SparkChat - Talk to strangers!</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:Arial,Helvetica,sans-serif;background:#fff}
    .page{max-width:1280px;margin:0 auto;height:100vh;display:flex;flex-direction:column}

    /* Top Bar */
    .topbar{height:90px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;
            border-bottom:6px solid #f5efe6;background:#fff}
    .title{font-size:40px;font-weight:700;color:#f57b00;transform:skewX(-6deg)}
    .title span{display:inline-block;transform-origin:center bottom}
    .title span.flip{animation:flip .6s ease-in-out}
    @keyframes flip{0%{transform:rotateX(0)}50%{transform:rotateX(180deg)}100%{transform:rotateX(360deg)}}
    .tag{font-size:28px;font-weight:700;color:#111;margin-left:10px}
    .online{color:#6aa6ff;font-weight:700}

    /* Videos Area */
    .videos-area{padding:20px 20px 0;background:#faf6f0;display:flex;gap:20px;flex:1}
    .video-box{
      flex:1;background:#595959;border-radius:8px;position:relative;
      border:6px solid rgba(0,0,0,0.06);overflow:hidden;height:48vh;min-height:300px
    }
    video{width:100%;height:100%;object-fit:cover}
    .video-label{
      position:absolute;top:10px;left:10px;background:rgba(255,255,255,0.7);
      padding:5px 10px;border-radius:5px;font-size:14px;z-index:10
    }
    .report-btn{
      position:absolute;top:10px;right:10px;background:#ff0000;color:#fff;
      border:none;padding:6px 10px;border-radius:5px;cursor:pointer;font-size:12px;
      z-index:10;display:none
    }
    .mic-btn{
      position:absolute;bottom:15px;left:50%;transform:translateX(-50%);
      background:rgba(0,0,0,0.6);color:#fff;width:44px;height:44px;border-radius:50%;
      border:none;font-size:22px;cursor:pointer;z-index:11;display:none
    }
    .logo-overlay{
      position:absolute;bottom:12px;left:50%;transform:translateX(-50%);
      color:rgba(255,255,255,0.8);font-weight:bold;font-size:19px;
      text-shadow:1px 1px 4px #000;pointer-events:none;z-index:10
    }
    .spinner{
      position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
      width:80px;height:80px;border:8px solid rgba(255,255,255,0.15);
      border-top:8px solid #fff;border-radius:50%;animation:spin 1s linear infinite
    }
    @keyframes spin{to{transform:translate(-50%,-50%) rotate(360deg)}}

    /* Chat Area (تحت الشاشتين تمامًا) */
    .chat-area{background:#fff;border-top:6px solid rgba(0,0,0,0.04);padding:15px 20px}
    .chat-messages{
      height:150px;overflow-y:auto;background:#fafafa;border:1px solid #ddd;
      padding:12px;border-radius:6px;margin-bottom:12px;font-size:14px;
      display:flex;flex-direction:column;gap:8px
    }
    .message{padding:8px 12px;border-radius:18px;max-width:80%;word-wrap:break-word}
    .message.you{background:#f60;color:#fff;align-self:flex-end}
    .message.stranger{background:#007bff;color:#fff;align-self:flex-start}
    .system-message{align-self:center;color:#888;font-style:italic;font-size:13px}

    .chatbar{display:flex;gap:10px;align-items:center}
    .chatbar input{flex:1;padding:12px;border:1px solid #ccc;border-radius:6px;font-size:15px}
    .chatbar input:focus{border-color:#f60;outline:none}
    .send-btn{background:#2da1ff;color:#fff;border:none;padding:12px 20px;
             border-radius:6px;cursor:pointer;font-weight:bold}
    .controls{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap}
    .control-btn{background:#3aa0ff;color:#fff;padding:11px 18px;border:none;
                 border-radius:6px;cursor:pointer;font-weight:bold}
    #stopBtn,#exitBtn{background:#ff4444}
    #exitBtn{background:#d32f2f}

    /* Mobile */
    @media(max-width:980px){
      .videos-area{flex-direction:column;padding:10px}
      .video-box{height:35vh}
      .topbar{height:70px;padding:0 10px}
      .title{font-size:32px}
      .tag{font-size:22px}
    }
    @media(max-width:480px){
      .video-box{height:30vh}
      .controls{justify-content:center}
      .control-btn{flex:1;font-size:14px;padding:10px}
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Top Bar -->
    <div class="topbar">
      <div style="display:flex;align-items:center">
        <div class="title">
          <span>S</span><span>p</span><span>a</span><span>r</span><span>k</span><span>C</span><span>h</span><span>a</span><span>t</span>
        </div>
        <div class="tag">Talk to strangers!</div>
      </div>
      <div class="online">16,700+ online now</div>
    </div>

    <!-- Videos (جنب بعض) -->
    <div class="videos-area">
      <div class="video-box">
        <div class="video-label">You</div>
        <video id="localVideo" autoplay muted></video>
        <button class="mic-btn" id="micBtn">Mic</button>
        <div class="logo-overlay">SparkChat</div>
        <div class="spinner" id="localSpinner"></div>
      </div>
      <div class="video-box">
        <div class="video-label">Stranger</div>
        <button class="report-btn" id="reportBtn">Report Porn</button>
        <video id="remoteVideo" autoplay></video>
        <div class="logo-overlay">SparkChat</div>
        <div class="spinner" id="remoteSpinner"></div>
      </div>
    </div>

    <!-- Chat (تحت الشاشتين) -->
    <div class="chat-area">
      <div id="status" style="text-align:center;margin-bottom:10px;color:#555">
        Click "Start" to begin the chat.
      </div>
      <div class="chat-messages" id="chatMessages"></div>

      <div class="controls">
        <button id="startBtn" class="control-btn">Start</button>
        <button id="skipBtn" class="control-btn" disabled>Skip</button>
        <button id="stopBtn" class="control-btn" disabled>Stop</button>
        <button id="exitBtn" class="control-btn" onclick="window.location.href='index.html'">Exit</button>
      </div>

      <div class="chatbar">
        <input type="text" id="chatInput" placeholder="Type a message..." disabled>
        <button class="send-btn" id="sendBtn" disabled>Send</button>
      </div>
    </div>
  </div>

  <!-- جميع السكربتات الأصلية بدون أي تغيير -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="script.js"></script>

  <!-- Flipping Letters Animation -->
  <script>
    setInterval(() => {
      const letters = document.querySelectorAll('.title span');
      const i = Math.floor(Math.random() * letters.length);
      letters[i].classList.add('flip');
      setTimeout(() => letters[i].classList.remove('flip'), 600);
    }, 800);
  </script>

  <!-- Report Porn Script (كما هو 100%) -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const reportBtn = document.getElementById('reportBtn');
      let isReporting = false;
      if (typeof socket !== 'undefined') {
        socket.on('partner-found', data => {
          reportBtn.style.display = 'block';
          window.partnerId = data.id;
        });
        socket.on('partner-disconnected', () => {
          reportBtn.style.display = 'none'; window.partnerId = null; isReporting = false;
        });
        socket.on('waiting', () => {
          reportBtn.style.display = 'none'; window.partnerId = null; isReporting = false;
        });
      }
      reportBtn.addEventListener('click', () => {
        if (!window.partnerId) return alert('No active partner.');
        if (isReporting) return;
        isReporting = true;
        reportBtn.disabled = true;
        reportBtn.textContent = 'Analyzing...';
        html2canvas(document.body).then(canvas => {
          socket.emit('reportPorn', {
            screenshot: canvas.toDataURL('image/png'),
            timestamp: new Date().toISOString(),
            partnerId: window.partnerId
          });
        }).catch(() => {
          alert('Screenshot failed');
          isReporting = false;
          reportBtn.disabled = false;
          reportBtn.textContent = 'Report Porn';
        });
      });
    });
  </script>
</body>
</html>
